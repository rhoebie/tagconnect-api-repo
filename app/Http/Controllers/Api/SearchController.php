<?php

namespace App\Http\Controllers\Api;

use App\Models\Barangay;
use Illuminate\Http\Request;
use App\Http\Controllers\Controller;
use Illuminate\Support\Facades\Auth;

class SearchController extends Controller
{

    public function searchUser(Request $request)
    {
        $taguig = [
            [14.5305143, 121.0222175],
            [14.5298321, 121.0225805],
            [14.5291517, 121.0229245],
            [14.5285303, 121.0232637],
            [14.5277451, 121.0236484],
            [14.5274192, 121.023866],
            [14.5270193, 121.0241032],
            [14.5267558, 121.0242258],
            [14.5261375, 121.0246645],
            [14.5259074, 121.0247434],
            [14.5244955, 121.0258539],
            [14.524021, 121.0260861],
            [14.5207653, 121.0277369],
            [14.5178912, 121.0292178],
            [14.5142183, 121.0312311],
            [14.5114923, 121.0326622],
            [14.5110088, 121.0327546],
            [14.5096793, 121.0334412],
            [14.5072895, 121.0347428],
            [14.5073296, 121.0350318],
            [14.5039707, 121.0367847],
            [14.5040679, 121.0370504],
            [14.504355, 121.0378015],
            [14.5047233, 121.0387611],
            [14.504208, 121.0399437],
            [14.5032694, 121.0420667],
            [14.5017298, 121.0437875],
            [14.5014438, 121.0442586],
            [14.5011234, 121.0449743],
            [14.5006166, 121.0459475],
            [14.5002722, 121.0466222],
            [14.5001437, 121.0468592],
            [14.4994098, 121.0470029],
            [14.4988211, 121.047134],
            [14.498673, 121.0471152],
            [14.4983773, 121.0471595],
            [14.4976482, 121.0472584],
            [14.4967428, 121.0473427],
            [14.4956456, 121.0474626],
            [14.4955974, 121.0470883],
            [14.4942539, 121.0472417],
            [14.4931526, 121.0473401],
            [14.4929862, 121.047355],
            [14.4928156, 121.0477584],
            [14.4923549, 121.0476578],
            [14.491653, 121.0475867],
            [14.4912416, 121.0475336],
            [14.4891206, 121.0471148],
            [14.4889423, 121.0471231],
            [14.4881811, 121.0468966],
            [14.4877715, 121.0468577],
            [14.4875786, 121.0466994],
            [14.4875079, 121.046572],
            [14.4872547, 121.0458874],
            [14.4862613, 121.0463639],
            [14.4861681, 121.0461398],
            [14.4856202, 121.0462852],
            [14.4853527, 121.0462809],
            [14.4845389, 121.046195],
            [14.4837439, 121.0460977],
            [14.4834031, 121.0460235],
            [14.4831301, 121.0459825],
            [14.482489, 121.0458861],
            [14.4817762, 121.045911],
            [14.4816322, 121.0459476],
            [14.4815699, 121.0459804],
            [14.4810492, 121.0461074],
            [14.4808635, 121.0461787],
            [14.4802701, 121.0465452],
            [14.4801364, 121.0465572],
            [14.4801488, 121.0466401],
            [14.4796339, 121.0468309],
            [14.4791685, 121.0469726],
            [14.4790776, 121.0470221],
            [14.4780747, 121.0473608],
            [14.4779607, 121.0473968],
            [14.4772396, 121.0476753],
            [14.4769044, 121.0478018],
            [14.4766414, 121.0478333],
            [14.4762369, 121.0479748],
            [14.47578, 121.0481194],
            [14.4756482, 121.048127],
            [14.4754509, 121.0481384],
            [14.4753255, 121.0481398],
            [14.4752811, 121.0481383],
            [14.4746977, 121.0481182],
            [14.4739861, 121.0480141],
            [14.4736957, 121.047948],
            [14.473584, 121.0479265],
            [14.4733198, 121.0478508],
            [14.4731614, 121.0477898],
            [14.4725434, 121.0475864],
            [14.4724323, 121.04753],
            [14.4724204, 121.0475243],
            [14.4725505, 121.0471666],
            [14.4727492, 121.0468949],
            [14.4723518, 121.0466583],
            [14.4722818, 121.0461192],
            [14.4716072, 121.0458497],
            [14.4714027, 121.045826],
            [14.4711377, 121.0458255],
            [14.4710442, 121.0463297],
            [14.4707443, 121.0462748],
            [14.4707049, 121.0464925],
            [14.4705532, 121.0473304],
            [14.4703998, 121.0479201],
            [14.4693157, 121.0477039],
            [14.4678752, 121.0475102],
            [14.4679397, 121.0479059],
            [14.4679558, 121.0481451],
            [14.4679462, 121.0484949],
            [14.4678486, 121.0487063],
            [14.4679664, 121.0490792],
            [14.4678657, 121.0491187],
            [14.4656657, 121.0490985],
            [14.4656754, 121.0505878],
            [14.464969, 121.0505917],
            [14.4649416, 121.0519931],
            [14.4650624, 121.0523541],
            [14.4651027, 121.0524746],
            [14.4654604, 121.0524576],
            [14.4659593, 121.0523906],
            [14.4659733, 121.0527629],
            [14.4666576, 121.0529793],
            [14.4671996, 121.0531506],
            [14.4672781, 121.0531772],
            [14.4672299, 121.0535324],
            [14.4672861, 121.0536698],
            [14.4673306, 121.053815],
            [14.467421, 121.0538588],
            [14.4674924, 121.0538773],
            [14.4675992, 121.0540515],
            [14.4676601, 121.054199],
            [14.4676756, 121.0543203],
            [14.4676441, 121.05443],
            [14.4675668, 121.0545895],
            [14.4674309, 121.0547332],
            [14.4672174, 121.0548736],
            [14.4670557, 121.0550114],
            [14.4669064, 121.0552544],
            [14.4668356, 121.0554416],
            [14.4668713, 121.0555847],
            [14.4669438, 121.0557168],
            [14.46707, 121.0560893],
            [14.4671062, 121.0563413],
            [14.4665214, 121.0573427],
            [14.4649343, 121.0610532],
            [14.4574543, 121.0774898],
            [14.454961, 121.0828971],
            [14.4514702, 121.1024664],
            [14.4513116, 121.122151],
            [14.4734115, 121.1184309],
            [14.4894504, 121.1183452],
            [14.50607, 121.1080455],
            [14.5085212, 121.1070156],
            [14.5111802, 121.1069726],
            [14.5135691, 121.1073803],
            [14.5166642, 121.1081313],
            [14.5199255, 121.1087322],
            [14.5228855, 121.1091077],
            [14.5246303, 121.109156],
            [14.5258455, 121.1094993],
            [14.5261723, 121.1084498],
            [14.5262505, 121.1079168],
            [14.5263165, 121.1073519],
            [14.5265725, 121.1067796],
            [14.5268807, 121.1062842],
            [14.5270866, 121.10605],
            [14.5273252, 121.1058943],
            [14.5275799, 121.1058193],
            [14.5278448, 121.1058086],
            [14.5281649, 121.1058336],
            [14.5289786, 121.1059607],
            [14.5296934, 121.1061519],
            [14.5302796, 121.1063523],
            [14.5308831, 121.1064392],
            [14.5312591, 121.1064309],
            [14.53167, 121.1063813],
            [14.5319938, 121.1062351],
            [14.5323348, 121.1059661],
            [14.5327312, 121.1056262],
            [14.5331207, 121.1051059],
            [14.5338787, 121.1040832],
            [14.5344058, 121.1033661],
            [14.5349437, 121.1027159],
            [14.5350627, 121.1025753],
            [14.535255, 121.1023432],
            [14.5355934, 121.1019847],
            [14.5357651, 121.1017269],
            [14.5362181, 121.1010718],
            [14.5363713, 121.1005837],
            [14.5367551, 121.0999466],
            [14.5369866, 121.0994225],
            [14.5370879, 121.0992793],
            [14.5372753, 121.0990146],
            [14.5376144, 121.0986764],
            [14.5378199, 121.0985228],
            [14.5382459, 121.0982797],
            [14.5387781, 121.0980772],
            [14.5390663, 121.0979551],
            [14.5393449, 121.097774],
            [14.539692, 121.0974884],
            [14.539991, 121.0972033],
            [14.5402595, 121.096835],
            [14.5404485, 121.0965653],
            [14.54061, 121.0963889],
            [14.540749, 121.0962844],
            [14.5409431, 121.0961877],
            [14.5411748, 121.0961428],
            [14.5413932, 121.0961541],
            [14.5416482, 121.0961669],
            [14.5419892, 121.0962033],
            [14.542457, 121.0963219],
            [14.5428665, 121.0964133],
            [14.5432131, 121.0963921],
            [14.5436138, 121.0962908],
            [14.543857, 121.0961738],
            [14.5441587, 121.0958944],
            [14.5444017, 121.0955441],
            [14.5446097, 121.0951646],
            [14.5448014, 121.0948958],
            [14.5449541, 121.0947346],
            [14.544712, 121.0942884],
            [14.5446743, 121.0932854],
            [14.5446411, 121.0923392],
            [14.5446535, 121.0921133],
            [14.5447106, 121.0918128],
            [14.545017, 121.0909398],
            [14.5450235, 121.0907292],
            [14.5449897, 121.0905227],
            [14.5448804, 121.0902407],
            [14.5443056, 121.0891199],
            [14.5440597, 121.0886656],
            [14.544011, 121.088565],
            [14.5438066, 121.0881426],
            [14.5435906, 121.0865376],
            [14.5439125, 121.0855967],
            [14.5437717, 121.0853275],
            [14.5437148, 121.0852186],
            [14.543034, 121.0840485],
            [14.5442198, 121.0840354],
            [14.5444275, 121.0838209],
            [14.5443942, 121.0827737],
            [14.5446269, 121.0824819],
            [14.5445189, 121.0818467],
            [14.5447266, 121.0815721],
            [14.5458481, 121.0811172],
            [14.5462635, 121.0811687],
            [14.5466652, 121.0810851],
            [14.546999, 121.0809541],
            [14.5469497, 121.080606],
            [14.5468017, 121.0803217],
            [14.5467238, 121.0800749],
            [14.5467297, 121.0796524],
            [14.5459395, 121.0792461],
            [14.5454909, 121.0784478],
            [14.5450865, 121.078162],
            [14.5449093, 121.0781389],
            [14.5448943, 121.0781186],
            [14.5448658, 121.0779812],
            [14.5448084, 121.0777734],
            [14.544794, 121.0776417],
            [14.5449188, 121.0773382],
            [14.545268, 121.0771825],
            [14.5454184, 121.0770018],
            [14.5454757, 121.0767534],
            [14.5454267, 121.076504],
            [14.545328, 121.0763518],
            [14.5452285, 121.0761497],
            [14.5449229, 121.075891],
            [14.5447953, 121.0758174],
            [14.5444323, 121.0756089],
            [14.5440241, 121.0754306],
            [14.5437349, 121.0752518],
            [14.5435912, 121.0750999],
            [14.5433536, 121.074865],
            [14.5431769, 121.0745306],
            [14.5427841, 121.0733327],
            [14.5425274, 121.0728048],
            [14.542264, 121.0723779],
            [14.5420885, 121.0722308],
            [14.5419022, 121.0721145],
            [14.5417233, 121.0720342],
            [14.5414376, 121.0718845],
            [14.5410201, 121.0725308],
            [14.5412683, 121.0727844],
            [14.5411537, 121.0728802],
            [14.5412787, 121.0730993],
            [14.5410325, 121.07326],
            [14.5400812, 121.0737205],
            [14.5400473, 121.0736081],
            [14.5398438, 121.0736741],
            [14.5397563, 121.0733814],
            [14.5396885, 121.0733868],
            [14.5396387, 121.0731982],
            [14.5397207, 121.0731762],
            [14.5396296, 121.0726729],
            [14.5401077, 121.0725039],
            [14.5400062, 121.0722071],
            [14.5397436, 121.0720791],
            [14.5394164, 121.072174],
            [14.5390071, 121.0717951],
            [14.5385296, 121.0716375],
            [14.5383362, 121.0705762],
            [14.5382747, 121.0703977],
            [14.5381698, 121.0702533],
            [14.5381265, 121.0701297],
            [14.5380636, 121.0699835],
            [14.5380392, 121.0698908],
            [14.5380343, 121.0692904],
            [14.5379348, 121.0689065],
            [14.5378272, 121.068586],
            [14.537874, 121.0675491],
            [14.5380103, 121.0675409],
            [14.5380408, 121.0674351],
            [14.5380088, 121.067034],
            [14.5379694, 121.066775],
            [14.5376932, 121.066386],
            [14.5375025, 121.0666966],
            [14.5371684, 121.0670322],
            [14.5369043, 121.0671773],
            [14.5366218, 121.067203],
            [14.5361902, 121.0670508],
            [14.535874, 121.0668597],
            [14.5355451, 121.0665609],
            [14.5353328, 121.0661281],
            [14.5351871, 121.0655926],
            [14.5354351, 121.0620727],
            [14.5353574, 121.0617987],
            [14.534974, 121.0612707],
            [14.5346586, 121.061161],
            [14.5339354, 121.0611411],
            [14.533353, 121.0612807],
            [14.5326945, 121.0614572],
            [14.5325196, 121.0613804],
            [14.5324531, 121.0612001],
            [14.5324282, 121.0610456],
            [14.5324198, 121.0609341],
            [14.5322869, 121.060874],
            [14.5321041, 121.0607538],
            [14.5319475, 121.0606107],
            [14.5318284, 121.0604112],
            [14.5315044, 121.0599751],
            [14.5314489, 121.0599155],
            [14.5314038, 121.0598816],
            [14.531184, 121.0597856],
            [14.5307937, 121.0596917],
            [14.5301808, 121.0594212],
            [14.5298644, 121.0593081],
            [14.5293906, 121.0591097],
            [14.5293137, 121.0589603],
            [14.5292982, 121.0585983],
            [14.5294432, 121.0570222],
            [14.5311861, 121.0575619],
            [14.5316726, 121.057654],
            [14.5322342, 121.0577058],
            [14.5327551, 121.057714],
            [14.5336923, 121.0576733],
            [14.5348681, 121.0575831],
            [14.5360037, 121.0575331],
            [14.5376435, 121.0574242],
            [14.5382864, 121.0573636],
            [14.5387096, 121.0572542],
            [14.539121, 121.0571079],
            [14.539741, 121.0567134],
            [14.5401585, 121.056285],
            [14.5403734, 121.0559776],
            [14.5411415, 121.0546976],
            [14.5414181, 121.054312],
            [14.5416934, 121.0539974],
            [14.5417981, 121.053906],
            [14.5419544, 121.0537856],
            [14.5422967, 121.0535737],
            [14.5425234, 121.0534574],
            [14.5427215, 121.053367],
            [14.5430368, 121.0533079],
            [14.5435309, 121.0533014],
            [14.5438874, 121.0533341],
            [14.5444154, 121.0534969],
            [14.5446646, 121.0536227],
            [14.5449659, 121.0538059],
            [14.5453012, 121.0541072],
            [14.5456283, 121.0545346],
            [14.5459438, 121.0550555],
            [14.5461654, 121.0554985],
            [14.5464258, 121.0558817],
            [14.5467643, 121.0562313],
            [14.5472441, 121.0564973],
            [14.5476269, 121.0566491],
            [14.5479675, 121.0567106],
            [14.5486996, 121.0568375],
            [14.5494047, 121.0571166],
            [14.5498017, 121.0575666],
            [14.5501842, 121.0582944],
            [14.5504768, 121.0587249],
            [14.550787, 121.0589326],
            [14.5512007, 121.059237],
            [14.5519299, 121.0597908],
            [14.5527988, 121.0604995],
            [14.5528085, 121.0602669],
            [14.55284, 121.0594346],
            [14.55284, 121.0591248],
            [14.552789, 121.0588806],
            [14.5527803, 121.0587546],
            [14.5528938, 121.0587384],
            [14.5529705, 121.0586272],
            [14.5531846, 121.0587627],
            [14.5532379, 121.0586782],
            [14.5534871, 121.058827],
            [14.5534448, 121.0589514],
            [14.5533542, 121.0590677],
            [14.5535235, 121.0592026],
            [14.5535948, 121.059106],
            [14.553735, 121.0592146],
            [14.5538298, 121.0592844],
            [14.553934, 121.0593356],
            [14.5539961, 121.059367],
            [14.5540613, 121.0593808],
            [14.5542171, 121.0593733],
            [14.5542555, 121.0593165],
            [14.554305, 121.0592903],
            [14.5544329, 121.0592847],
            [14.5545187, 121.0592895],
            [14.5547185, 121.0593079],
            [14.5550188, 121.0593581],
            [14.5552373, 121.0594775],
            [14.5554316, 121.0592119],
            [14.5555451, 121.0593255],
            [14.5556651, 121.0595537],
            [14.5557237, 121.0596491],
            [14.5557827, 121.0597805],
            [14.5556486, 121.0598912],
            [14.5558132, 121.0605616],
            [14.5557481, 121.0608453],
            [14.5558159, 121.060886],
            [14.5560043, 121.0608643],
            [14.556059, 121.0608555],
            [14.5562695, 121.0608674],
            [14.5563452, 121.060736],
            [14.5567037, 121.0608807],
            [14.5567334, 121.0609868],
            [14.5569705, 121.0608942],
            [14.5569908, 121.0609314],
            [14.5573519, 121.0608219],
            [14.5572257, 121.0606045],
            [14.5573678, 121.0604603],
            [14.5575291, 121.0602731],
            [14.5576824, 121.0600473],
            [14.5578113, 121.0598529],
            [14.5579184, 121.0596198],
            [14.5579913, 121.0593979],
            [14.5581662, 121.0588219],
            [14.5582629, 121.0585519],
            [14.5583804, 121.0582934],
            [14.5584327, 121.0582702],
            [14.5586577, 121.0581409],
            [14.5590045, 121.0578979],
            [14.5591753, 121.0578533],
            [14.5593847, 121.057728],
            [14.5594784, 121.0577476],
            [14.5595724, 121.0576375],
            [14.5597049, 121.0575716],
            [14.5598023, 121.0574642],
            [14.5599318, 121.05728],
            [14.5604471, 121.0567884],
            [14.5607438, 121.056334],
            [14.5610831, 121.0558081],
            [14.5614649, 121.0551833],
            [14.5619678, 121.0543019],
            [14.5621305, 121.0538889],
            [14.5616022, 121.0539181],
            [14.5614227, 121.0538913],
            [14.5615333, 121.0535308],
            [14.5615903, 121.0527073],
            [14.5609508, 121.0527228],
            [14.5609178, 121.0531223],
            [14.5608465, 121.0537273],
            [14.5606926, 121.0537119],
            [14.5606556, 121.0536159],
            [14.5602945, 121.0534868],
            [14.5601772, 121.0532643],
            [14.5602329, 121.0531521],
            [14.5601781, 121.052941],
            [14.5602985, 121.0528958],
            [14.5601941, 121.0525344],
            [14.5601789, 121.0524853],
            [14.5600398, 121.0520664],
            [14.5599841, 121.0518555],
            [14.5601366, 121.0516569],
            [14.5596655, 121.0513965],
            [14.5588946, 121.0510859],
            [14.5582666, 121.050881],
            [14.5583735, 121.0505481],
            [14.5582235, 121.0504816],
            [14.5580971, 121.0508287],
            [14.5576565, 121.0507076],
            [14.5575462, 121.050882],
            [14.5573148, 121.0515439],
            [14.5571829, 121.0514875],
            [14.5568851, 121.0513927],
            [14.5569151, 121.0510514],
            [14.5564178, 121.0510313],
            [14.556659, 121.0501523],
            [14.556727, 121.049874],
            [14.5566063, 121.049725],
            [14.5560263, 121.0490092],
            [14.5558541, 121.0485498],
            [14.5556414, 121.0480406],
            [14.5553868, 121.047557],
            [14.5563016, 121.0464999],
            [14.5555124, 121.0458021],
            [14.5556305, 121.0453278],
            [14.5556401, 121.0452797],
            [14.5557804, 121.0448505],
            [14.5556708, 121.0448122],
            [14.555602, 121.0447866],
            [14.5557395, 121.0440401],
            [14.5556564, 121.0440225],
            [14.5556997, 121.043743],
            [14.5557465, 121.0435431],
            [14.5558946, 121.0433222],
            [14.5558683, 121.0432527],
            [14.555733, 121.0429478],
            [14.5557168, 121.0426481],
            [14.5557042, 121.0420176],
            [14.5558306, 121.0416732],
            [14.5551225, 121.0420593],
            [14.5547659, 121.042275],
            [14.5543893, 121.0425083],
            [14.5541687, 121.0426589],
            [14.5539386, 121.0428042],
            [14.5535483, 121.0429267],
            [14.5533298, 121.0429894],
            [14.5531124, 121.0430551],
            [14.5529957, 121.0430953],
            [14.5528898, 121.0431245],
            [14.5527253, 121.0431708],
            [14.5521494, 121.0433163],
            [14.5512896, 121.0435761],
            [14.5498251, 121.0437118],
            [14.5496348, 121.0437644],
            [14.549085, 121.0439314],
            [14.5481128, 121.0442524],
            [14.5479517, 121.0443131],
            [14.5467858, 121.0447482],
            [14.5457715, 121.0451079],
            [14.5451562, 121.0453182],
            [14.5450027, 121.0453648],
            [14.5440559, 121.0457066],
            [14.5433455, 121.0459208],
            [14.5432977, 121.0459352],
            [14.5425326, 121.0462228],
            [14.5424669, 121.0462475],
            [14.5422475, 121.0463376],
            [14.5420351, 121.046476],
            [14.5417747, 121.0467657],
            [14.5417211, 121.0469074],
            [14.541625, 121.0469284],
            [14.5414823, 121.0469597],
            [14.5417143, 121.0461761],
            [14.5419183, 121.0460129],
            [14.5418487, 121.04594],
            [14.5417745, 121.0456447],
            [14.5417119, 121.0454851],
            [14.541453, 121.0453692],
            [14.5412121, 121.0452662],
            [14.5410376, 121.0451117],
            [14.5409047, 121.0448456],
            [14.5408881, 121.0446482],
            [14.5409509, 121.0442464],
            [14.5408798, 121.0440474],
            [14.5407219, 121.0438414],
            [14.5405724, 121.0436183],
            [14.540456, 121.0433436],
            [14.540373, 121.043129],
            [14.5404145, 121.042966],
            [14.5404976, 121.04282],
            [14.5406554, 121.0426484],
            [14.5407302, 121.0423995],
            [14.5407551, 121.0421677],
            [14.5406887, 121.0419789],
            [14.5406887, 121.0418587],
            [14.5407884, 121.0416785],
            [14.5407468, 121.041421],
            [14.5406887, 121.0411721],
            [14.5404976, 121.0408974],
            [14.5403647, 121.0406829],
            [14.5401985, 121.0406485],
            [14.5400323, 121.040597],
            [14.5399576, 121.0404683],
            [14.5398911, 121.0401679],
            [14.5398994, 121.0399962],
            [14.5398622, 121.0397429],
            [14.5397168, 121.0396477],
            [14.5395816, 121.0396294],
            [14.5393679, 121.0393758],
            [14.5390356, 121.0394077],
            [14.5387592, 121.0394139],
            [14.5381898, 121.0393097],
            [14.5377951, 121.039267],
            [14.5376758, 121.039362],
            [14.5375514, 121.039323],
            [14.5374203, 121.0391939],
            [14.5373646, 121.0390381],
            [14.5372322, 121.0388651],
            [14.537122, 121.03876],
            [14.5370414, 121.038683],
            [14.5369492, 121.0386622],
            [14.53676, 121.0386497],
            [14.5365969, 121.0384142],
            [14.5363843, 121.0383532],
            [14.5362272, 121.0380135],
            [14.5361191, 121.0377131],
            [14.5360595, 121.0375178],
            [14.5360527, 121.037387],
            [14.5361358, 121.037241],
            [14.5361939, 121.0371037],
            [14.5361663, 121.036947],
            [14.536061, 121.0367261],
            [14.5359197, 121.0365458],
            [14.5359183, 121.0363594],
            [14.5358977, 121.0361301],
            [14.535892, 121.0359281],
            [14.5356352, 121.035305],
            [14.535495, 121.0351401],
            [14.5351777, 121.0347815],
            [14.5347934, 121.0345615],
            [14.5345738, 121.0343845],
            [14.5343661, 121.0340052],
            [14.5340421, 121.0336962],
            [14.5340088, 121.0335932],
            [14.5340753, 121.0334216],
            [14.5341999, 121.0331212],
            [14.5344409, 121.0327006],
            [14.5345406, 121.0324603],
            [14.5345489, 121.0322114],
            [14.5345239, 121.031971],
            [14.5345126, 121.0317672],
            [14.5346486, 121.0316535],
            [14.5349635, 121.0314019],
            [14.5350238, 121.0313572],
            [14.5349823, 121.0311507],
            [14.534868, 121.0306719],
            [14.5346818, 121.0302544],
            [14.5345738, 121.0301686],
            [14.5343687, 121.0301296],
            [14.534306, 121.0300889],
            [14.5343247, 121.0300158],
            [14.5343567, 121.0299534],
            [14.5344285, 121.0298599],
            [14.5344497, 121.0297378],
            [14.5344325, 121.0295592],
            [14.5343162, 121.0294305],
            [14.534175, 121.0294219],
            [14.5340597, 121.0293526],
            [14.5340332, 121.0291924],
            [14.5340736, 121.0290645],
            [14.5340612, 121.0289246],
            [14.5339706, 121.0289076],
            [14.5338759, 121.0289155],
            [14.5336765, 121.0288726],
            [14.5334935, 121.02865],
            [14.5332611, 121.0283576],
            [14.5331385, 121.0280981],
            [14.533045, 121.0278254],
            [14.5330284, 121.0275765],
            [14.5329287, 121.0273963],
            [14.5327459, 121.0271559],
            [14.532505, 121.0268555],
            [14.5322946, 121.0266938],
            [14.5321375, 121.0265791],
            [14.532124, 121.0265333],
            [14.5321267, 121.0263917],
            [14.5321525, 121.0261659],
            [14.53221, 121.0255557],
            [14.5322308, 121.0253449],
            [14.5322073, 121.0251669],
            [14.5321715, 121.0250014],
            [14.5321385, 121.0249671],
            [14.5320683, 121.0249666],
            [14.5316157, 121.0249332],
            [14.5314636, 121.0249139],
            [14.5314168, 121.0248245],
            [14.5314062, 121.0247419],
            [14.531517, 121.0243387],
            [14.5314887, 121.0242589],
            [14.5312673, 121.0242792],
            [14.5311709, 121.0242553],
            [14.5311407, 121.0241767],
            [14.5311644, 121.0238451],
            [14.5312205, 121.0232492],
            [14.5309466, 121.0231896],
            [14.5308799, 121.023139],
            [14.5308487, 121.0230635],
            [14.5308731, 121.0225585],
            [14.5307399, 121.0224681],
            [14.5305143, 121.0222175]
        ];

        $latitude = $request->input('latitude');
        $longitude = $request->input('longitude');

        if (!$latitude || !$longitude) {
            return response('Latitude and longitude are required.', 400);
        }
        if (Auth::check()) {
            // Check if the location is inside Taguig City
            if ($this->isPointInArray($latitude, $longitude, $taguig)) {
                // Retrieve all barangays with non-null boundaries
                $barangays = Barangay::whereNotNull('boundary')->get();

                $insideBarangay = null;
                $minDistance = PHP_INT_MAX;

                // Iterate through each barangay to find if the point is inside
                foreach ($barangays as $barangay) {
                    $boundary = $barangay->boundary;

                    // Split the boundary into an array of points (assuming it's in WKT format)
                    $points = explode(',', str_replace(['POLYGON', '(', ')'], '', $boundary));
                    $points = array_map(function ($point) {
                        list($lng, $lat) = explode(' ', trim($point));
                        return ['lat' => (float) $lat, 'lng' => (float) $lng];
                    }, $points);

                    if ($this->isPointInPolygon($latitude, $longitude, $points)) {
                        return response()->json(['Exact' => $barangay->name], 200);
                    }

                    // If not inside, calculate the distance to the closest point on the boundary
                    $distance = $this->calculateDistanceToBoundary($latitude, $longitude, $points);

                    if ($distance < $minDistance) {
                        $minDistance = $distance;
                        $insideBarangay = $barangay->name;
                    }
                }

                if ($insideBarangay) {
                    return response()->json(['Near' => $insideBarangay], 200);
                } else {
                    return response("No barangays with boundaries found in the database.");
                }
            } else {
                return response()->json(['Unauthorized' => 'This application is only for the citizens of Taguig City'], 401);
            }
        } else {
            // Handle the case where the user is not authenticated
            return response()->json(['message' => 'Unauthorized.'], 401);
        }

    }

    // Function to check if a point is inside a array
    function isPointInArray($latitude, $longitude, $coordinates)
    {
        $isInside = false;
        $count = count($coordinates);

        for ($i = 0, $j = $count - 1; $i < $count; $j = $i++) {
            $lat1 = $coordinates[$i][0];
            $lng1 = $coordinates[$i][1];
            $lat2 = $coordinates[$j][0];
            $lng2 = $coordinates[$j][1];

            if (
                (($lat1 > $latitude) != ($lat2 > $latitude)) &&
                ($longitude < ($lng2 - $lng1) * ($latitude - $lat1) / ($lat2 - $lat1) + $lng1)
            ) {
                $isInside = !$isInside;
            }
        }

        return $isInside;
    }

    // Function to check if a point is inside a polygon
    private function isPointInPolygon($latitude, $longitude, $points)
    {
        $isInside = false;
        $count = count($points);

        for ($i = 0, $j = $count - 1; $i < $count; $j = $i++) {
            if (
                (($points[$i]['lat'] > $latitude) != ($points[$j]['lat'] > $latitude)) &&
                ($longitude < ($points[$j]['lng'] - $points[$i]['lng']) * ($latitude - $points[$i]['lat']) / ($points[$j]['lat'] - $points[$i]['lat']) + $points[$i]['lng'])
            ) {
                $isInside = !$isInside;
            }
        }

        return $isInside;
    }

    // Function to calculate the minimum distance from a point to the boundary of a polygon
    private function calculateDistanceToBoundary($latitude, $longitude, $points)
    {
        $minDistance = PHP_INT_MAX;

        for ($i = 0; $i < count($points); $i++) {
            $lat1 = $points[$i]['lat'];
            $lng1 = $points[$i]['lng'];
            $lat2 = $points[($i + 1) % count($points)]['lat'];
            $lng2 = $points[($i + 1) % count($points)]['lng'];

            $distance = $this->calculatePointToLineDistance($latitude, $longitude, $lat1, $lng1, $lat2, $lng2);

            if ($distance < $minDistance) {
                $minDistance = $distance;
            }
        }

        return $minDistance;
    }

    // Function to calculate the minimum distance from a point to a line segment
    private function calculatePointToLineDistance($lat, $lng, $lat1, $lng1, $lat2, $lng2)
    {
        $a = $lat - $lat1;
        $b = $lng - $lng1;
        $c = $lat2 - $lat1;
        $d = $lng2 - $lng1;

        $dot = $a * $c + $b * $d;
        $lenSq = $c * $c + $d * $d;

        if ($lenSq == 0) {
            return $this->calculateHaversineDistance($lat, $lng, $lat1, $lng1);
        }

        $param = $dot / $lenSq;

        if ($param < 0) {
            return $this->calculateHaversineDistance($lat, $lng, $lat1, $lng1);
        } elseif ($param > 1) {
            return $this->calculateHaversineDistance($lat, $lng, $lat2, $lng2);
        }

        $xx = $lat1 + $param * $c;
        $yy = $lng1 + $param * $d;

        return $this->calculateHaversineDistance($lat, $lng, $xx, $yy);
    }

    // Function to calculate the Haversine distance between two points
    private function calculateHaversineDistance($lat1, $lng1, $lat2, $lng2)
    {
        $earthRadius = 6371; // Radius of the Earth in kilometers
        $lat1Rad = deg2rad($lat1);
        $lng1Rad = deg2rad($lng1);
        $lat2Rad = deg2rad($lat2);
        $lng2Rad = deg2rad($lng2);

        $dLat = $lat2Rad - $lat1Rad;
        $dLng = $lng2Rad - $lng1Rad;

        $a = sin($dLat / 2) * sin($dLat / 2) + cos($lat1Rad) * cos($lat2Rad) * sin($dLng / 2) * sin($dLng / 2);
        $c = 2 * atan2(sqrt($a), sqrt(1 - $a));
        $distance = $earthRadius * $c;

        return $distance;
    }


}